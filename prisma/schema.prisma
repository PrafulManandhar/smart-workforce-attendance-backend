generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CompanyStatus {
  DRAFT
  ACTIVE_TRIAL
  ACTIVE_PAID
  SUSPENDED
}

enum Role {
  SUPER_ADMIN
  COMPANY_ADMIN
  MANAGER
  EMPLOYEE
}

model Company {
  id        String        @id @default(cuid())
  name      String?
  code      String?       @unique
  timezone  String        @default("Australia/Sydney")
  isActive  Boolean       @default(true)

  status    CompanyStatus @default(DRAFT)

  trialStartAt  DateTime?
  trialEndAt    DateTime?
  employeeLimit Int?

  estimatedEmployeeRange String?
  currentRosteringMethod String?
  phoneNumber            String?
  jobTitle               String?
  onboardingCompletedAt  DateTime?

  annualLeaveRatio Float?
  sickLeaveRatio   Float?

  users     User[]
  employees EmployeeProfile[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String  @id @default(cuid())
  email     String  @unique
  passwordHash String
  role      Role
  isActive  Boolean @default(true)

  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])

  employeeProfile EmployeeProfile?

  hashedRefreshToken String?
  resetPasswordTokenHash String?
  resetPasswordExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmployeeProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])

  companyId       String
  company         Company  @relation(fields: [companyId], references: [id])

  firstName       String
  lastName        String
  position        String?

  hasWFHPermission  Boolean @default(false)
  homeLatitude      Float?
  homeLongitude     Float?
  isSummaryRequired Boolean @default(false)

  managerId       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
